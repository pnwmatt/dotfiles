{{- /* Checks if running interactively */ -}}
{{- $interactive := stdinIsATTY -}}

{{- /* Template file for chezmoi config file */ -}}
{{- $workstation := false -}}{{/* true if this machine is a desktop/workstation */}}
{{- $headless := false -}}
{{- $private_server := false -}}{{/* true if this is a private server (for services like dnote) */}}

{{- if hasKey . "workstation" -}}
{{-   $workstation = .workstation -}}
{{- else if $interactive -}}
{{-   $workstation = promptBool "workstation" -}}
{{- end -}}

{{- if hasKey . "workstation" -}}
{{-   if hasKey . "headless" -}}
{{-     $headless = .headless -}}
{{-   else if $interactive -}}
{{-     $headless = promptBool "headless" -}}
{{-   end -}}
{{- end -}}

{{- if hasKey . "private_server" -}}
{{-   $private_server = .private_server -}}
{{- else if $interactive -}}
{{-   $private_server = promptBool "private_server (for services like dnote that should only run on trusted servers)" -}}
{{- end -}}

{{- if false -}}
encryption = "age"
[age]
  identity = "{{ .chezmoi.homeDir }}/.config/sops/age/chezmoi.txt"
  recipient = "age19kk2hhldesux98t50r9wmdhdvj7xw29205gy58tj70m53p5dweksv70uh9"
{{- else -}}
{{-   writeToStdout "Encryption in chezmoi is currently disabled!\n" -}}
{{- end -}}

[data]
  workstation = {{ $workstation }}
  headless = {{ $headless }}
  private_server = {{ $private_server }}


{{- writeToStdout "Installing SQLRsync v0.0.9\b" -}}
[data.sqlrsync]
  enabled = true
  install_method = "github"
  version = "0.0.9"
  install_dir = "/usr/local/bin"

{{- writeToStdout " - Done\n" -}}

{{- if eq .chezmoi.hostname "nuc3" }}
{{-   writeToStdout "Configuring sqlrsync for earthquakes.db\n" -}}
[[data.sqlrsync.databases]]
  name = "gov.usgs.earthquakes"
  remote = "usgs.gov/earthquakes.db"
  local_path = "~/workspace/sqlrsync-client/examples/earthquakes/earthquakes.db"
  sync_mode = "subscribe"
  enabled = true
  subscribe_flags = "--waitIdle=10s"
{{-   writeToStdout " - Done\n" -}}
{{- end }}

{{- if $private_server }}
{{-   writeToStdout "Configuring sqlrsync for dnote.db\n" -}}
[[data.sqlrsync.databases]]
  name = "dnote"
  remote = "mchomelab/dnote/dnote.db"
  local_path = "~/.local/share/dnote/dnote.db"
  sync_mode = "subscribe"
  enabled = true
  subscribe_flags = "--waitIdle=10s"
{{-   writeToStdout " - Done\n" -}}
{{- end }}
